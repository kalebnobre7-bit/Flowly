<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flowly - To-Do Inteligente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: #0a0a0a;
            color: #e5e5e5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .task-completed {
            text-decoration: line-through;
            opacity: 0.5;
        }
        .day-column {
            border-right: 1px solid #1a1a1a;
        }
        .day-column:last-child {
            border-right: none;
        }
        .day-column.drag-over {
            background: #1a1a2a;
            border: 2px dashed #3b82f6;
        }
        .period-section {
            position: relative;
        }
        .period-section:hover .add-task-btn {
            opacity: 1;
        }
        .add-task-btn {
            opacity: 0;
            transition: opacity 0.2s;
            cursor: pointer;
            padding: 6px 10px;
            background: #1a1a1a;
            border: 1px dashed #404040;
            border-radius: 4px;
            font-size: 12px;
            color: #888;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
        }
        .add-task-btn:hover {
            background: #252525;
            border-color: #555;
            color: #aaa;
        }
        .task-input {
            background: #1a1a1a;
            border: 2px solid #3b82f6;
            border-radius: 4px;
            padding: 6px 10px;
            color: #e5e5e5;
            font-size: 13px;
            width: 100%;
            outline: none;
            margin-top: 4px;
        }
        .period-badge {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 4px;
            background: #1a1a1a;
            display: inline-block;
            margin-bottom: 8px;
        }
        .checkbox-custom {
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #404040;
            border-radius: 4px;
            cursor: pointer;
            flex-shrink: 0;
        }
        .checkbox-custom:checked {
            background: #3b82f6;
            border-color: #3b82f6;
        }
        .checkbox-custom:checked::after {
            content: '‚úì';
            color: white;
            font-size: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .task-item {
            cursor: grab;
            transition: all 0.2s;
            position: relative;
        }
        .task-item:active {
            cursor: grabbing;
            opacity: 0.5;
        }
        .task-item.dragging {
            opacity: 0.3;
        }
        .task-item.is-habit::before {
            content: 'üîÑ';
            position: absolute;
            left: -20px;
            font-size: 12px;
        }
        .task-label {
            user-select: none;
        }
        .task-label[contenteditable="true"] {
            user-select: text;
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
            border-radius: 3px;
            padding: 2px 4px;
            margin: -2px -4px;
        }
        .color-menu {
            position: absolute;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 8px;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .color-menu.show {
            display: flex;
            gap: 4px;
        }
        .color-swatch {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s;
        }
        .color-swatch:hover {
            transform: scale(1.1);
            border-color: #555;
        }
        .edit-toolbar {
            position: absolute;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 4px;
            display: none;
            z-index: 999;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            gap: 2px;
        }
        .edit-toolbar.show {
            display: flex;
        }
        .toolbar-btn {
            padding: 6px 10px;
            background: transparent;
            border: none;
            color: #999;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.15s;
        }
        .toolbar-btn:hover {
            background: #2a2a2a;
            color: #fff;
        }
        .floating-add-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            background: #3b82f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            transition: all 0.2s;
            z-index: 100;
        }
        .floating-add-btn:hover {
            transform: scale(1.1);
            background: #4f96ff;
        }
        .quick-add-menu {
            position: fixed;
            bottom: 100px;
            right: 30px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 8px;
            display: none;
            z-index: 999;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            min-width: 200px;
        }
        .quick-add-menu.show {
            display: block;
        }
        .quick-add-option {
            padding: 10px 12px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 13px;
            transition: all 0.15s;
        }
        .quick-add-option:hover {
            background: #2a2a2a;
        }
        .habit-card {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid #252525;
        }
        .habit-card:hover {
            border-color: #333;
        }
        .streak-badge {
            background: linear-gradient(135deg, #f97316, #fb923c);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .stat-card {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            border: 1px solid #252525;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #252525;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            transition: width 0.3s;
        }
        
        /* Notion color classes */
        .color-default { color: #e5e5e5; }
        .color-gray { color: #9b9a97; }
        .color-brown { color: #937264; }
        .color-orange { color: #d9730d; }
        .color-yellow { color: #cb912f; }
        .color-green { color: #448361; }
        .color-blue { color: #337ea9; }
        .color-purple { color: #9065b0; }
        .color-pink { color: #c14c8a; }
        .color-red { color: #d44c47; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-[1600px] mx-auto">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                    <svg class="w-12 h-12" viewBox="0 0 100 100" fill="white">
                        <path d="M20 20 L50 50 L20 80" stroke="white" stroke-width="8" fill="none"/>
                    </svg>
                    <h1 class="text-4xl font-bold" id="viewTitle">Week</h1>
                </div>
                
                <!-- View Toggle -->
                <div class="flex gap-2 bg-[#1a1a1a] p-1 rounded-lg">
                    <button id="btnToday" class="px-6 py-2 rounded-md text-sm font-medium transition-all text-gray-400 hover:text-white">
                        Hoje
                    </button>
                    <button id="btnWeek" class="px-6 py-2 rounded-md text-sm font-medium transition-all bg-[#2a2a2a] text-white">
                        Semana
                    </button>
                    <button id="btnHabits" class="px-6 py-2 rounded-md text-sm font-medium transition-all text-gray-400 hover:text-white">
                        H√°bitos
                    </button>
                </div>
            </div>
            <p class="text-gray-400 text-lg">S√≥ existe o hoje, foco no que traz grana.</p>
        </div>

        <!-- Content Area -->
        <div id="contentArea">
            <!-- Week Grid -->
            <div id="weekGrid" class="grid grid-cols-7 gap-0">
                <!-- Days will be inserted here -->
            </div>

            <!-- Habits View -->
            <div id="habitsView" class="hidden">
                <!-- Habits content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Floating Add Button -->
    <div id="floatingAddBtn" class="floating-add-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
    </div>

    <!-- Quick Add Menu -->
    <div id="quickAddMenu" class="quick-add-menu">
        <div class="quick-add-option" data-type="routine">üìã Adicionar rotina di√°ria</div>
        <div class="quick-add-option" data-type="custom">‚úèÔ∏è Nova tarefa customizada</div>
    </div>

    <!-- Color Menu -->
    <div id="colorMenu" class="color-menu">
        <div class="color-swatch" style="background: #e5e5e5;" data-color="default" title="Default"></div>
        <div class="color-swatch" style="background: #9b9a97;" data-color="gray" title="Gray"></div>
        <div class="color-swatch" style="background: #937264;" data-color="brown" title="Brown"></div>
        <div class="color-swatch" style="background: #d9730d;" data-color="orange" title="Orange"></div>
        <div class="color-swatch" style="background: #cb912f;" data-color="yellow" title="Yellow"></div>
        <div class="color-swatch" style="background: #448361;" data-color="green" title="Green"></div>
        <div class="color-swatch" style="background: #337ea9;" data-color="blue" title="Blue"></div>
        <div class="color-swatch" style="background: #9065b0;" data-color="purple" title="Purple"></div>
        <div class="color-swatch" style="background: #c14c8a;" data-color="pink" title="Pink"></div>
        <div class="color-swatch" style="background: #d44c47;" data-color="red" title="Red"></div>
    </div>

    <!-- Edit Toolbar -->
    <div id="editToolbar" class="edit-toolbar">
        <button class="toolbar-btn" data-action="color" title="Cor do texto">üé®</button>
        <button class="toolbar-btn" data-action="habit" title="Marcar como h√°bito">üîÑ</button>
        <div style="width: 1px; background: #333; margin: 0 2px;"></div>
        <button class="toolbar-btn" data-action="delete" title="Deletar">üóëÔ∏è</button>
    </div>

    <script>
        let currentView = 'week';
        let draggedTask = null;
        let currentEditingTask = null;
        
        const dailyRoutine = [
            { text: "Ora√ß√£o e Salmo", completed: false, color: "default", isHabit: false },
            { text: "Venvanse", completed: false, color: "default", isHabit: false },
            { text: "Ler metas e mantra; celular na gaveta", completed: false, color: "default", isHabit: false }
        ];
        
        const weekData = {
            "Segunda": {
                "Manh√£ (8h-12h)": [
                    { text: "Ora√ß√£o e Salmo", completed: true, color: "default", isHabit: true },
                    { text: "Venva + Cetoconazol", completed: true, color: "default", isHabit: false },
                    { text: "Ler metas e mantra; celular na gaveta", completed: true, color: "default", isHabit: true },
                    { text: "Finalizar com leo", completed: true, color: "default", isHabit: false },
                    { text: "cobrar leo e bless", completed: true, color: "default", isHabit: false }
                ]
            },
            "Ter√ßa": {
                "Manh√£ (8h-12h)": [
                    { text: "Ora√ß√£o e Salmo", completed: true, color: "default", isHabit: true },
                    { text: "Venva + Cetoconazol", completed: true, color: "default", isHabit: false },
                    { text: "Ler metas e mantra; celular na gaveta", completed: true, color: "default", isHabit: true },
                    { text: "Deixar destaques na mesma cor", completed: true, color: "default", isHabit: false },
                    { text: "Prospec√ß√£o no Threads", completed: true, color: "default", isHabit: false },
                    { text: "Follow-up de propostas enviadas (15min)", completed: true, color: "default", isHabit: false },
                    { text: "Link Pagamento L√©o + Bless", completed: true, color: "default", isHabit: false }
                ],
                "Tarde (14h-18h)": [
                    { text: "Call Semanal com Fred (14h30)", completed: true, color: "default", isHabit: false },
                    { text: "[QCS] P√°gina de Vendas (2h)", completed: true, color: "default", isHabit: false }
                ]
            },
            "Quarta": {
                "Manh√£ (8h-12h)": [
                    { text: "Ora√ß√£o e Salmo", completed: true, color: "default", isHabit: true },
                    { text: "Ler metas e mantra", completed: true, color: "default", isHabit: true },
                    { text: "Cobrar a cara", completed: true, color: "default", isHabit: false },
                    { text: "2 posts no Threads + Prospec√ß√£o", completed: true, color: "default", isHabit: false }
                ],
                "Tarde (14h-18h)": [
                    { text: "Postar +1 Avalia√ß√£o no Storie (10min)", completed: false, color: "default", isHabit: false },
                    { text: "Copiar a J√©ssica jessicacostaft", completed: false, color: "default", isHabit: false },
                    { text: "Story + Frase", completed: false, color: "default", isHabit: false }
                ]
            },
            "Quinta": {
                "Manh√£ (8h-12h)": [
                    { text: "Ora√ß√£o e Salmo", completed: true, color: "default", isHabit: true },
                    { text: "Venvanse", completed: true, color: "default", isHabit: true },
                    { text: "Ler metas e mantra", completed: true, color: "default", isHabit: true },
                    { text: "Responder DMs/emails clientes (10min)", completed: true, color: "default", isHabit: false },
                    { text: "Videoz√£o pro Raul", completed: true, color: "default", isHabit: false },
                    { text: "[QCS] P√°gina de Obrigado (1h)", completed: true, color: "default", isHabit: false },
                    { text: "Postar p√°gina de obrigado e do ebook", completed: true, color: "default", isHabit: false }
                ],
                "Tarde (14h-18h)": [
                    { text: "Portf√≥lio Sabor Energ√©tico (2h)", completed: false, color: "default", isHabit: false }
                ],
                "Noite": [
                    { text: "Corridinha ou 25 Flex√µes", completed: false, color: "default", isHabit: true },
                    { text: "Atualizar links lizdesign.com.br (30min)", completed: false, color: "default", isHabit: false },
                    { text: "[Mawi] Finalizar ajustes do site (1h)", completed: false, color: "default", isHabit: false },
                    { text: "SITE PRO WILL MEIO URGENTE", completed: false, color: "red", isHabit: false }
                ]
            },
            "Sexta": {
                "Manh√£ (8h-12h)": [
                    { text: "Ora√ß√£o e Salmo", completed: false, color: "default", isHabit: true },
                    { text: "Venva, Ler metas e mantra", completed: false, color: "default", isHabit: true },
                    { text: "SEGUIR PLANO DA IA", completed: false, color: "default", isHabit: false }
                ],
                "Tarde (14h-18h)": [
                    { text: "postar status no Zap", completed: false, color: "default", isHabit: false },
                    { text: "postar Carrosselzinho", completed: false, color: "default", isHabit: false },
                    { text: "Atualizar se√ß√£o de portf√≥lio no site com trabalhos", completed: false, color: "default", isHabit: false },
                    { text: "Perguntar em SUBS de DEV sobre app (30min)", completed: false, color: "default", isHabit: false }
                ],
                "Noite": [
                    { text: "[BATCH] Posts pra 7 dias insta Viviane (2h)", completed: false, color: "default", isHabit: false },
                    { text: "Ler Livro", completed: false, color: "default", isHabit: true }
                ]
            },
            "S√°bado": {
                "Manh√£ (8h-12h)": [
                    { text: "Ora√ß√£o e Salmo", completed: false, color: "default", isHabit: true },
                    { text: "Buscar verdola", completed: false, color: "default", isHabit: false },
                    { text: "Postar Storie (10min)", completed: false, color: "default", isHabit: false },
                    { text: "Networking: msg pra 3 pessoas (30min)", completed: false, color: "default", isHabit: false },
                    { text: "Fred e Kaleb Reuni√£o Presencial", completed: false, color: "pink", isHabit: false }
                ],
                "Tarde (14h-18h)": [
                    { text: "Prospectar no Threads (30min)", completed: false, color: "default", isHabit: false },
                    { text: "Revisar finan√ßas + organizar pagamentos (1h)", completed: false, color: "default", isHabit: false }
                ],
                "Noite": [
                    { text: "Pensar: A QCS tem um funil, e a minha opera√ß√£o? (1h)", completed: false, color: "default", isHabit: false },
                    { text: "Post insta Viviane", completed: false, color: "default", isHabit: false },
                    { text: "Ler Livro", completed: false, color: "default", isHabit: true }
                ]
            },
            "Domingo": {
                "Manh√£ (8h-12h)": [
                    { text: "Ora√ß√£o e Salmo", completed: false, color: "default", isHabit: true },
                    { text: "Ler metas e mantra", completed: false, color: "default", isHabit: true },
                    { text: "Backup semanal arquivos (15min)", completed: false, color: "default", isHabit: true }
                ],
                "Tarde (14h-18h)": [
                    { text: "Post insta Viviane", completed: false, color: "default", isHabit: false },
                    { text: "Ritual semanal: Revis√£o + Planejar pr√≥xima (1h)", completed: false, color: "default", isHabit: true }
                ],
                "Noite": [
                    { text: "Ler Livro", completed: false, color: "default", isHabit: true },
                    { text: "Comprar perfil pra tr√°fego (15min)", completed: false, color: "default", isHabit: false }
                ]
            }
        };

        // Habits tracking data
        let habitsHistory = JSON.parse(localStorage.getItem('habitsHistory') || '{}');

        function getAllHabits() {
            const habits = [];
            const habitMap = new Map();
            
            Object.entries(weekData).forEach(([day, periods]) => {
                Object.entries(periods).forEach(([period, tasks]) => {
                    tasks.forEach(task => {
                        if (task.isHabit && !habitMap.has(task.text)) {
                            habitMap.set(task.text, {
                                text: task.text,
                                color: task.color,
                                completedToday: task.completed
                            });
                        }
                    });
                });
            });
            
            return Array.from(habitMap.values());
        }

        function getHabitStreak(habitText) {
            if (!habitsHistory[habitText]) return 0;
            
            const today = new Date();
            let streak = 0;
            let currentDate = new Date(today);
            
            while (true) {
                const dateKey = currentDate.toISOString().split('T')[0];
                if (habitsHistory[habitText][dateKey]) {
                    streak++;
                    currentDate.setDate(currentDate.getDate() - 1);
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function getHabitCompletionRate(habitText, days = 30) {
            if (!habitsHistory[habitText]) return 0;
            
            const today = new Date();
            let completed = 0;
            
            for (let i = 0; i < days; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateKey = date.toISOString().split('T')[0];
                if (habitsHistory[habitText][dateKey]) {
                    completed++;
                }
            }
            
            return Math.round((completed / days) * 100);
        }

        function markHabitCompleted(habitText, completed) {
            const today = new Date().toISOString().split('T')[0];
            
            if (!habitsHistory[habitText]) {
                habitsHistory[habitText] = {};
            }
            
            if (completed) {
                habitsHistory[habitText][today] = true;
            } else {
                delete habitsHistory[habitText][today];
            }
            
            localStorage.setItem('habitsHistory', JSON.stringify(habitsHistory));
        }

        function renderHabitsView() {
            const view = document.getElementById('habitsView');
            const habits = getAllHabits();
            
            if (habits.length === 0) {
                view.innerHTML = '<p class="text-gray-400 text-center py-20">Nenhum h√°bito cadastrado ainda. Marque tasks como h√°bitos clicando com o bot√£o direito!</p>';
                return;
            }
            
            let html = `
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-2xl font-bold mb-6">Meus H√°bitos üîÑ</h2>
                    
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-3 gap-4 mb-8">
                        <div class="stat-card">
                            <div class="text-gray-400 text-sm mb-1">Total de H√°bitos</div>
                            <div class="text-3xl font-bold">${habits.length}</div>
                        </div>
                        <div class="stat-card">
                            <div class="text-gray-400 text-sm mb-1">Conclu√≠dos Hoje</div>
                            <div class="text-3xl font-bold text-green-400">${habits.filter(h => h.completedToday).length}</div>
                        </div>
                        <div class="stat-card">
                            <div class="text-gray-400 text-sm mb-1">Taxa Hoje</div>
                            <div class="text-3xl font-bold text-blue-400">${habits.length > 0 ? Math.round((habits.filter(h => h.completedToday).length / habits.length) * 100) : 0}%</div>
                        </div>
                    </div>
                    
                    <!-- Habits List -->
                    <div class="space-y-3">
            `;
            
            habits.forEach((habit, index) => {
                const streak = getHabitStreak(habit.text);
                const completionRate = getHabitCompletionRate(habit.text, 30);
                
                html += `
                    <div class="habit-card">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-start gap-3 flex-1">
                                <input 
                                    type="checkbox" 
                                    class="checkbox-custom mt-1" 
                                    ${habit.completedToday ? 'checked' : ''}
                                    onchange="toggleHabitToday('${habit.text.replace(/'/g, "\\'")}', this.checked)"
                                >
                                <div class="flex-1">
                                    <div class="color-${habit.color} font-medium mb-2">${habit.text}</div>
                                    <div class="flex items-center gap-3">
                                        ${streak > 0 ? `<span class="streak-badge">üî• ${streak} ${streak === 1 ? 'dia' : 'dias'}</span>` : ''}
                                        <span class="text-xs text-gray-400">${completionRate}% nos √∫ltimos 30 dias</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${completionRate}%"></div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            view.innerHTML = html;
        }

        function toggleHabitToday(habitText, completed) {
            // Update in weekData
            Object.entries(weekData).forEach(([day, periods]) => {
                Object.entries(periods).forEach(([period, tasks]) => {
                    tasks.forEach(task => {
                        if (task.isHabit && task.text === habitText) {
                            task.completed = completed;
                        }
                    });
                });
            });
            
            markHabitCompleted(habitText, completed);
            saveToLocalStorage();
            renderHabitsView();
        }

        function createTaskElement(day, period, task, index) {
            const taskDiv = document.createElement('div');
            taskDiv.className = `task-item flex items-start gap-2 mb-2 ${task.isHabit ? 'is-habit' : ''}`;
            taskDiv.draggable = true;
            taskDiv.dataset.day = day;
            taskDiv.dataset.period = period;
            taskDiv.dataset.index = index;
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'checkbox-custom mt-1';
            checkbox.checked = task.completed;
            checkbox.addEventListener('change', (e) => {
                e.stopPropagation();
                taskLabel.classList.toggle('task-completed');
                task.completed = checkbox.checked;
                
                if (task.isHabit) {
                    markHabitCompleted(task.text, task.completed);
                }
                
                saveToLocalStorage();
            });
            
            const taskLabel = document.createElement('span');
            taskLabel.className = `task-label text-sm cursor-pointer color-${task.color} ${task.completed ? 'task-completed' : ''}`;
            taskLabel.textContent = task.text;
            
            taskLabel.addEventListener('dblclick', (e) => {
                e.stopPropagation();
                startEditing(taskLabel, task, taskDiv);
            });
            
            taskLabel.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                e.stopPropagation();
                showEditToolbar(e, task, taskLabel);
            });
            
            taskDiv.addEventListener('dragstart', handleDragStart);
            taskDiv.addEventListener('dragend', handleDragEnd);
            
            taskDiv.appendChild(checkbox);
            taskDiv.appendChild(taskLabel);
            
            return taskDiv;
        }

        function createAddTaskButton(day, period) {
            const btn = document.createElement('div');
            btn.className = 'add-task-btn';
            btn.innerHTML = '<span style="font-size: 16px;">+</span> Adicionar tarefa';
            
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                showTaskInput(btn, day, period);
            });
            
            return btn;
        }

        function showTaskInput(button, day, period) {
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'task-input';
            input.placeholder = 'Digite a tarefa...';
            
            button.replaceWith(input);
            input.focus();
            
            const saveTask = () => {
                const text = input.value.trim();
                if (text) {
                    if (!weekData[day][period]) {
                        weekData[day][period] = [];
                    }
                    weekData[day][period].push({
                        text: text,
                        completed: false,
                        color: 'default',
                        isHabit: false
                    });
                    saveToLocalStorage();
                }
                renderView();
            };
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    saveTask();
                } else if (e.key === 'Escape') {
                    renderView();
                }
            });
            
            input.addEventListener('blur', () => {
                setTimeout(() => saveTask(), 100);
            });
        }

        function addDailyRoutine(day) {
            const morningPeriod = "Manh√£ (8h-12h)";
            if (!weekData[day][morningPeriod]) {
                weekData[day][morningPeriod] = [];
            }
            
            dailyRoutine.forEach(task => {
                weekData[day][morningPeriod].push({...task});
            });
            
            saveToLocalStorage();
            renderView();
        }

        function startEditing(label, task, taskDiv) {
            if (currentEditingTask) {
                finishEditing();
            }
            
            currentEditingTask = { label, task, originalText: task.text };
            label.contentEditable = true;
            label.focus();
            
            const range = document.createRange();
            range.selectNodeContents(label);
            const sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
            
            taskDiv.draggable = false;
            
            label.addEventListener('blur', finishEditing);
            label.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    finishEditing();
                } else if (e.key === 'Escape') {
                    task.text = currentEditingTask.originalText;
                    label.textContent = task.text;
                    finishEditing();
                }
            });
        }

        function finishEditing() {
            if (!currentEditingTask) return;
            
            const { label, task } = currentEditingTask;
            label.contentEditable = false;
            task.text = label.textContent.trim();
            
            const taskDiv = label.closest('.task-item');
            if (taskDiv) taskDiv.draggable = true;
            
            saveToLocalStorage();
            currentEditingTask = null;
        }

        function showEditToolbar(e, task, label) {
            const toolbar = document.getElementById('editToolbar');
            const colorMenu = document.getElementById('colorMenu');
            
            colorMenu.classList.remove('show');
            
            toolbar.style.left = e.pageX + 'px';
            toolbar.style.top = e.pageY + 'px';
            toolbar.classList.add('show');
            
            toolbar.dataset.taskDay = label.closest('.task-item').dataset.day;
            toolbar.dataset.taskPeriod = label.closest('.task-item').dataset.period;
            toolbar.dataset.taskIndex = label.closest('.task-item').dataset.index;
            
            const buttons = toolbar.querySelectorAll('.toolbar-btn');
            buttons.forEach(btn => {
                btn.onclick = (e) => {
                    e.stopPropagation();
                    const action = btn.dataset.action;
                    
                    if (action === 'color') {
                        showColorMenu(e, task, label);
                    } else if (action === 'habit') {
                        task.isHabit = !task.isHabit;
                        saveToLocalStorage();
                        toolbar.classList.remove('show');
                        renderView();
                    } else if (action === 'delete') {
                        deleteTask(toolbar.dataset.taskDay, toolbar.dataset.taskPeriod, toolbar.dataset.taskIndex);
                        toolbar.classList.remove('show');
                        renderView();
                    }
                };
            });
        }

        function showColorMenu(e, task, label) {
            const colorMenu = document.getElementById('colorMenu');
            const toolbar = document.getElementById('editToolbar');
            
            const rect = toolbar.getBoundingClientRect();
            colorMenu.style.left = rect.left + 'px';
            colorMenu.style.top = (rect.bottom + 5) + 'px';
            colorMenu.classList.add('show');
            
            const swatches = colorMenu.querySelectorAll('.color-swatch');
            swatches.forEach(swatch => {
                swatch.onclick = () => {
                    const color = swatch.dataset.color;
                    task.color = color;
                    label.className = label.className.replace(/color-\w+/, `color-${color}`);
                    saveToLocalStorage();
                    colorMenu.classList.remove('show');
                    toolbar.classList.remove('show');
                };
            });
        }

        function deleteTask(day, period, index) {
            const tasks = weekData[day][period];
            tasks.splice(index, 1);
            saveToLocalStorage();
        }

        function handleDragStart(e) {
            draggedTask = {
                day: this.dataset.day,
                period: this.dataset.period,
                index: parseInt(this.dataset.index),
                task: weekData[this.dataset.day][this.dataset.period][parseInt(this.dataset.index)]
            };
            
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.day-column').forEach(col => {
                col.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) {
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            this.classList.remove('drag-over');
            
            if (!draggedTask) return;
            
            const targetDay = this.dataset.day;
            const targetPeriod = this.dataset.period || Object.keys(weekData[targetDay])[0];
            
            const originalTasks = weekData[draggedTask.day][draggedTask.period];
            originalTasks.splice(draggedTask.index, 1);
            
            if (!weekData[targetDay][targetPeriod]) {
                weekData[targetDay][targetPeriod] = [];
            }
            weekData[targetDay][targetPeriod].push(draggedTask.task);
            
            saveToLocalStorage();
            renderView();
            
            draggedTask = null;
            
            return false;
        }

        function renderWeek() {
            const grid = document.getElementById('weekGrid');
            grid.innerHTML = '';
            grid.className = 'grid grid-cols-7 gap-0';
            
            Object.entries(weekData).forEach(([day, periods]) => {
                const dayColumn = document.createElement('div');
                dayColumn.className = 'day-column p-4 min-h-[600px]';
                dayColumn.dataset.day = day;
                
                dayColumn.addEventListener('dragover', handleDragOver);
                dayColumn.addEventListener('dragenter', handleDragEnter);
                dayColumn.addEventListener('dragleave', handleDragLeave);
                dayColumn.addEventListener('drop', handleDrop);
                
                const dayHeader = document.createElement('h2');
                dayHeader.className = 'text-xl font-bold mb-4';
                dayHeader.textContent = day;
                dayColumn.appendChild(dayHeader);
                
                Object.entries(periods).forEach(([period, tasks]) => {
                    const periodDiv = document.createElement('div');
                    periodDiv.className = 'period-section mb-6';
                    periodDiv.dataset.period = period;
                    
                    const periodLabel = document.createElement('div');
                    periodLabel.className = 'period-badge';
                    periodLabel.textContent = period;
                    periodDiv.appendChild(periodLabel);
                    
                    tasks.forEach((task, index) => {
                        const taskDiv = createTaskElement(day, period, task, index);
                        periodDiv.appendChild(taskDiv);
                    });
                    
                    const addBtn = createAddTaskButton(day, period);
                    periodDiv.appendChild(addBtn);
                    
                    dayColumn.appendChild(periodDiv);
                });
                
                grid.appendChild(dayColumn);
            });
        }

        function renderToday() {
            const grid = document.getElementById('weekGrid');
            grid.innerHTML = '';
            grid.className = 'max-w-2xl mx-auto';
            
            const days = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
            const today = days[new Date().getDay()];
            
            const todayData = weekData[today];
            
            if (!todayData) {
                grid.innerHTML = '<p class="text-gray-400 text-center py-20">Nenhuma tarefa para hoje!</p>';
                return;
            }
            
            const dayContainer = document.createElement('div');
            dayContainer.className = 'p-6';
            dayContainer.dataset.day = today;
            
            dayContainer.addEventListener('dragover', handleDragOver);
            dayContainer.addEventListener('drop', handleDrop);
            
            const dateStr = new Date().toLocaleDateString('pt-BR', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const todayHeader = document.createElement('h2');
            todayHeader.className = 'text-3xl font-bold mb-2 capitalize';
            todayHeader.textContent = today;
            dayContainer.appendChild(todayHeader);
            
            const dateSubtitle = document.createElement('p');
            dateSubtitle.className = 'text-gray-400 mb-8 capitalize';
            dateSubtitle.textContent = dateStr;
            dayContainer.appendChild(dateSubtitle);
            
            Object.entries(todayData).forEach(([period, tasks]) => {
                const periodDiv = document.createElement('div');
                periodDiv.className = 'period-section mb-8';
                periodDiv.dataset.period = period;
                
                const periodHeader = document.createElement('h3');
                periodHeader.className = 'text-xl font-semibold mb-4 text-gray-300';
                periodHeader.textContent = period;
                periodDiv.appendChild(periodHeader);
                
                tasks.forEach((task, index) => {
                    const taskDiv = createTaskElement(today, period, task, index);
                    taskDiv.className = `task-item flex items-start gap-3 mb-3 p-3 bg-[#1a1a1a] rounded-lg hover:bg-[#252525] transition-all ${task.isHabit ? 'is-habit' : ''}`;
                    periodDiv.appendChild(taskDiv);
                });
                
                const addBtn = createAddTaskButton(today, period);
                periodDiv.appendChild(addBtn);
                
                dayContainer.appendChild(periodDiv);
            });
            
            grid.appendChild(dayContainer);
        }

        function renderView() {
            const weekGrid = document.getElementById('weekGrid');
            const habitsView = document.getElementById('habitsView');
            
            if (currentView === 'habits') {
                weekGrid.classList.add('hidden');
                habitsView.classList.remove('hidden');
                renderHabitsView();
            } else {
                weekGrid.classList.remove('hidden');
                habitsView.classList.add('hidden');
                
                if (currentView === 'week') {
                    renderWeek();
                } else {
                    renderToday();
                }
            }
        }

        function setView(view) {
            currentView = view;
            
            const btnToday = document.getElementById('btnToday');
            const btnWeek = document.getElementById('btnWeek');
            const btnHabits = document.getElementById('btnHabits');
            const viewTitle = document.getElementById('viewTitle');
            
            btnToday.className = 'px-6 py-2 rounded-md text-sm font-medium transition-all text-gray-400 hover:text-white';
            btnWeek.className = 'px-6 py-2 rounded-md text-sm font-medium transition-all text-gray-400 hover:text-white';
            btnHabits.className = 'px-6 py-2 rounded-md text-sm font-medium transition-all text-gray-400 hover:text-white';
            
            if (view === 'today') {
                btnToday.className = 'px-6 py-2 rounded-md text-sm font-medium transition-all bg-[#2a2a2a] text-white';
                viewTitle.textContent = 'Hoje';
            } else if (view === 'habits') {
                btnHabits.className = 'px-6 py-2 rounded-md text-sm font-medium transition-all bg-[#2a2a2a] text-white';
                viewTitle.textContent = 'H√°bitos';
            } else {
                btnWeek.className = 'px-6 py-2 rounded-md text-sm font-medium transition-all bg-[#2a2a2a] text-white';
                viewTitle.textContent = 'Week';
            }
            
            renderView();
        }

        function saveToLocalStorage() {
            localStorage.setItem('weekData', JSON.stringify(weekData));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('weekData');
            if (saved) {
                const savedData = JSON.parse(saved);
                Object.keys(weekData).forEach(day => {
                    if (savedData[day]) {
                        weekData[day] = savedData[day];
                    }
                });
            }
        }

        document.getElementById('floatingAddBtn').addEventListener('click', () => {
            const menu = document.getElementById('quickAddMenu');
            menu.classList.toggle('show');
        });

        document.querySelectorAll('.quick-add-option').forEach(option => {
            option.addEventListener('click', () => {
                const type = option.dataset.type;
                const days = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
                const today = days[new Date().getDay()];
                
                if (type === 'routine') {
                    addDailyRoutine(today);
                } else if (type === 'custom') {
                    setTimeout(() => {
                        const firstAddBtn = document.querySelector('.add-task-btn');
                        if (firstAddBtn) firstAddBtn.click();
                    }, 100);
                }
                
                document.getElementById('quickAddMenu').classList.remove('show');
            });
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('#editToolbar') && !e.target.closest('#colorMenu')) {
                document.getElementById('editToolbar').classList.remove('show');
                document.getElementById('colorMenu').classList.remove('show');
            }
            if (!e.target.closest('#floatingAddBtn') && !e.target.closest('#quickAddMenu')) {
                document.getElementById('quickAddMenu').classList.remove('show');
            }
        });

        document.getElementById('btnToday').addEventListener('click', () => setView('today'));
        document.getElementById('btnWeek').addEventListener('click', () => setView('week'));
        document.getElementById('btnHabits').addEventListener('click', () => setView('habits'));

        loadFromLocalStorage();
        renderWeek();
    </script>
</body>
</html>

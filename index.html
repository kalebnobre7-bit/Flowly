<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Flowly - Produtividade</title>
    <meta name="theme-color" content="#1c1c1e">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="lightning.svg">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="styles.css?v=3">
    <style>
        /* Custom tweaks for mobile inputs */
        input:focus {
            font-size: 16px !important;
        }

        /* Prevent Zoom */
    </style>
</head>

<body class="bg-[#1c1c1e] text-gray-200 select-none pb-24 md:pb-0 safe-area-bottom">

    <!-- App Container -->
    <div id="app" class="max-w-6xl mx-auto min-h-screen relative shadow-2xl overflow-hidden bg-[#1c1c1e]">

        <!-- Header (Desktop/Tablet) -->
        <header
            class="flex items-center justify-between p-4 md:p-6 bg-[#1c1c1e]/95 backdrop-blur-md sticky top-0 z-30 border-b border-white/5">
            <div class="flex items-center gap-3 group">
                <div
                    class="relative w-9 h-9 flex items-center justify-center bg-blue-600 rounded-xl shadow-[0_0_15px_rgba(37,99,235,0.4)]">
                    <i data-lucide="zap" class="w-5 h-5 text-white fill-white"></i>
                </div>
                <h1 class="text-2xl font-black tracking-tight text-white italic">FLOWLY</h1>
            </div>

            <div class="flex items-center gap-3">
                <!-- Desktop Nav -->
                <nav class="hidden md:flex bg-[#2c2c2e] p-1 rounded-xl border border-white/5">
                    <button
                        class="segment-btn px-4 py-1.5 rounded-lg text-sm font-medium text-gray-400 hover:text-white transition-all active"
                        onclick="setView('week')">Semana</button>
                    <button
                        class="segment-btn px-4 py-1.5 rounded-lg text-sm font-medium text-gray-400 hover:text-white transition-all"
                        onclick="setView('today')">Hoje</button>
                    <button
                        class="segment-btn px-4 py-1.5 rounded-lg text-sm font-medium text-gray-400 hover:text-white transition-all"
                        onclick="setView('routine')">Rotina</button>
                    <button
                        class="segment-btn px-4 py-1.5 rounded-lg text-sm font-medium text-gray-400 hover:text-white transition-all"
                        onclick="setView('analytics')">Analytics</button>
                    <button
                        class="p-1.5 ml-1 hover:bg-white/10 rounded-lg text-gray-400 hover:text-white transition-colors"
                        onclick="setView('settings')">
                        <i data-lucide="settings-2" class="w-4 h-4"></i>
                    </button>
                </nav>

                <!-- Week Controls (Visible on Week View) -->
                <div id="weekNav"
                    class="hidden md:flex items-center bg-[#2c2c2e] rounded-lg border border-white/5 mx-2">
                    <button id="btnPrevWeek" class="p-2 hover:bg-white/5 text-gray-400 hover:text-white"
                        onclick="changeWeek(-1)">
                        <i data-lucide="chevron-left" class="w-4 h-4"></i>
                    </button>
                    <span id="weekLabel" class="text-xs font-mono text-gray-400 px-2 min-w-[100px] text-center">Semana
                        Atual</span>
                    <button id="btnNextWeek" class="p-2 hover:bg-white/5 text-gray-400 hover:text-white"
                        onclick="changeWeek(1)">
                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                    </button>
                </div>

                <button id="btnUser"
                    class="w-9 h-9 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 border border-white/10 flex items-center justify-center hover:border-blue-500/50 transition-colors relative">
                    <i data-lucide="user" class="w-4 h-4 text-gray-300"></i>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="p-4 md:p-6 w-full max-w-full overflow-x-hidden relative z-10">
            <!-- Mobile Week Nav (Only on mobile + week view) -->
            <div
                class="md:hidden flex items-center justify-between mb-4 bg-[#2c2c2e]/50 p-2 rounded-xl border border-white/5">
                <button onclick="changeWeek(-1)" class="p-2 text-gray-400"><i data-lucide="chevron-left"
                        class="w-5 h-5"></i></button>
                <span id="weekLabelMobile" class="text-xs font-mono text-gray-300">Semana Atual</span>
                <button onclick="changeWeek(1)" class="p-2 text-gray-400"><i data-lucide="chevron-right"
                        class="w-5 h-5"></i></button>
            </div>

            <!-- Views -->
            <div id="contentArea" class="w-full">
                <div id="weekGrid" class="grid grid-cols-1 md:grid-cols-7 gap-4 w-full"></div>
                <div id="routineView" class="hidden w-full"></div>
                <div id="analyticsView" class="hidden w-full"></div>
                <div id="settingsView" class="hidden w-full"></div>
                <!-- Placeholders so app.js doesn't crash -->
                <div id="monthView" class="hidden"></div>
                <div id="todayView" class="hidden"></div>
            </div>
        </main>

        <!-- Bottom Navigation (Mobile) -->
        <nav
            class="md:hidden fixed bottom-0 left-0 right-0 z-40 bg-[#1c1c1e]/90 backdrop-blur-xl border-t border-white/10 pb-[env(safe-area-inset-bottom)]">
            <div class="flex justify-around items-center h-16 px-2">
                <button
                    class="flex flex-col items-center gap-1 w-14 text-gray-500 active:text-blue-500 transition-colors"
                    onclick="setView('week')">
                    <i data-lucide="calendar" class="w-6 h-6"></i>
                    <span class="text-[10px] font-medium">Semana</span>
                </button>
                <button
                    class="flex flex-col items-center gap-1 w-14 text-gray-500 active:text-blue-500 transition-colors"
                    onclick="setView('routine')">
                    <i data-lucide="check-circle-2" class="w-6 h-6"></i>
                    <span class="text-[10px] font-medium">Rotina</span>
                </button>

                <!-- SPACE FOR FAB -->
                <div class="w-16"></div>

                <button
                    class="flex flex-col items-center gap-1 w-14 text-gray-500 active:text-blue-500 transition-colors"
                    onclick="setView('analytics')">
                    <i data-lucide="bar-chart-2" class="w-6 h-6"></i>
                    <span class="text-[10px] font-medium">Dados</span>
                </button>
                <button
                    class="flex flex-col items-center gap-1 w-14 text-gray-500 active:text-blue-500 transition-colors"
                    onclick="setView('settings')">
                    <i data-lucide="settings-2" class="w-6 h-6"></i>
                    <span class="text-[10px] font-medium">Ajustes</span>
                </button>
            </div>
        </nav>

        <!-- Floating Action Button (FAB) -->
        <button id="floatingAddBtn"
            class="fixed bottom-6 left-1/2 -translate-x-1/2 w-14 h-14 bg-blue-600 rounded-full shadow-[0_4px_20px_rgba(37,99,235,0.5)] flex items-center justify-center text-white z-50 hover:scale-110 active:scale-95 transition-all md:bottom-8 md:right-8 md:left-auto md:translate-x-0">
            <i data-lucide="plus" class="w-7 h-7"></i>
        </button>

        <!-- Quick Add Menu -->
        <div id="quickAddMenu"
            class="fixed bottom-24 left-1/2 -translate-x-1/2 w-64 bg-[#2c2c2e] border border-white/10 rounded-2xl shadow-2xl p-2 hidden flex-col gap-1 z-50 md:right-8 md:left-auto md:translate-x-0 md:bottom-24 transform origin-bottom transition-all">
            <button
                class="quick-add-option w-full p-3 hover:bg-white/5 rounded-xl flex items-center gap-3 text-left transition-colors"
                data-type="custom">
                <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400"><i
                        data-lucide="check-square" class="w-4 h-4"></i></div>
                <div>
                    <span class="block text-sm font-medium text-white">Nova Tarefa</span>
                    <span class="block text-xs text-gray-500">Adicionar para hoje</span>
                </div>
            </button>
            <button
                class="quick-add-option w-full p-3 hover:bg-white/5 rounded-xl flex items-center gap-3 text-left transition-colors"
                data-type="routine">
                <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center text-purple-400"><i
                        data-lucide="repeat" class="w-4 h-4"></i></div>
                <div>
                    <span class="block text-sm font-medium text-white">Rotina Diária</span>
                    <span class="block text-xs text-gray-500">Hábito recorrente</span>
                </div>
            </button>
            <button
                class="quick-add-option w-full p-3 hover:bg-white/5 rounded-xl flex items-center gap-3 text-left transition-colors"
                data-type="weekly">
                <div class="w-8 h-8 rounded-full bg-orange-500/20 flex items-center justify-center text-orange-400"><i
                        data-lucide="calendar-clock" class="w-4 h-4"></i></div>
                <div>
                    <span class="block text-sm font-medium text-white">Semanal</span>
                    <span class="block text-xs text-gray-500">Dias específicos</span>
                </div>
            </button>
        </div>

        <!-- Weekly Recurrence Modal -->
        <div id="weeklyModal"
            class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
            <div class="bg-[#2c2c2e] w-full max-w-sm rounded-2xl border border-white/10 shadow-2xl p-6">
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i data-lucide="calendar-repeat" class="w-6 h-6 text-blue-500"></i>
                    Tarefa Semanal
                </h2>
                <input type="text" id="weeklyTaskText"
                    class="w-full bg-[#1c1c1e] text-white p-3 rounded-xl border border-white/5 mb-4 outline-none focus:border-blue-500/50"
                    placeholder="Ex: Academia, Inglês...">

                <p class="text-xs text-gray-500 uppercase font-bold mb-2">Dias da semana</p>
                <div class="flex justify-between gap-1 mb-6">
                    <button
                        class="weekly-day-btn flex-1 py-2 rounded-lg text-xs font-medium bg-[#1c1c1e] hover:bg-blue-500/20 text-gray-400 hover:text-blue-400 border border-white/5 transition-colors"
                        data-day="0">D</button>
                    <button
                        class="weekly-day-btn flex-1 py-2 rounded-lg text-xs font-medium bg-[#1c1c1e] hover:bg-blue-500/20 text-gray-400 hover:text-blue-400 border border-white/5 transition-colors"
                        data-day="1">S</button>
                    <button
                        class="weekly-day-btn flex-1 py-2 rounded-lg text-xs font-medium bg-[#1c1c1e] hover:bg-blue-500/20 text-gray-400 hover:text-blue-400 border border-white/5 transition-colors"
                        data-day="2">T</button>
                    <button
                        class="weekly-day-btn flex-1 py-2 rounded-lg text-xs font-medium bg-[#1c1c1e] hover:bg-blue-500/20 text-gray-400 hover:text-blue-400 border border-white/5 transition-colors"
                        data-day="3">Q</button>
                    <button
                        class="weekly-day-btn flex-1 py-2 rounded-lg text-xs font-medium bg-[#1c1c1e] hover:bg-blue-500/20 text-gray-400 hover:text-blue-400 border border-white/5 transition-colors"
                        data-day="4">Q</button>
                    <button
                        class="weekly-day-btn flex-1 py-2 rounded-lg text-xs font-medium bg-[#1c1c1e] hover:bg-blue-500/20 text-gray-400 hover:text-blue-400 border border-white/5 transition-colors"
                        data-day="5">S</button>
                    <button
                        class="weekly-day-btn flex-1 py-2 rounded-lg text-xs font-medium bg-[#1c1c1e] hover:bg-blue-500/20 text-gray-400 hover:text-blue-400 border border-white/5 transition-colors"
                        data-day="6">S</button>
                </div>

                <div class="flex gap-3">
                    <button id="btnCancelWeekly"
                        class="flex-1 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 font-medium transition-colors"
                        onclick="document.getElementById('weeklyModal').style.display='none'">Cancelar</button>
                    <button id="btnSaveWeekly"
                        class="flex-1 py-3 rounded-xl bg-blue-600 hover:bg-blue-500 text-white font-bold shadow-lg shadow-blue-500/20 transition-all">Salvar</button>
                </div>
            </div>
        </div>

        <!-- Auth Modal -->
        <div id="authModal"
            class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
            <div class="bg-[#2c2c2e] w-full max-w-md p-6 md:p-8 rounded-2xl border border-white/10 shadow-2xl transform transition-all"
                id="authBox">
                <div class="text-center mb-6">
                    <div
                        class="w-14 h-14 bg-blue-600 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg shadow-blue-600/30">
                        <i data-lucide="zap" class="w-7 h-7 text-white fill-white"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-1">Bem-vindo</h2>
                </div>

                <!-- LOGIN FORM -->
                <div id="authLogin" class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Email</label>
                        <input type="email" id="loginEmail"
                            class="w-full mt-1 bg-[#1c1c1e] text-white p-3 rounded-xl border border-white/5 outline-none focus:border-blue-500/50 transition-colors"
                            placeholder="seu@email.com">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Senha</label>
                        <input type="password" id="loginPassword"
                            class="w-full mt-1 bg-[#1c1c1e] text-white p-3 rounded-xl border border-white/5 outline-none focus:border-blue-500/50 transition-colors"
                            placeholder="••••••••">
                    </div>
                    <button id="btnLogin"
                        class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-blue-600/20 active:scale-[0.98] transition-all">Entrar</button>
                    <p class="text-center text-sm text-gray-400 mt-2">
                        Não tem conta? <button id="btnShowSignup"
                            class="text-blue-400 hover:text-white font-medium">Criar Agora</button>
                    </p>
                </div>

                <!-- SIGNUP FORM -->
                <div id="authSignup" class="space-y-4 hidden">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Email</label>
                        <input type="email" id="signupEmail"
                            class="w-full mt-1 bg-[#1c1c1e] text-white p-3 rounded-xl border border-white/5 outline-none focus:border-green-500/50 transition-colors"
                            placeholder="seu@email.com">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Senha</label>
                        <input type="password" id="signupPassword"
                            class="w-full mt-1 bg-[#1c1c1e] text-white p-3 rounded-xl border border-white/5 outline-none focus:border-green-500/50 transition-colors"
                            placeholder="Mínimo 6 caracteres">
                    </div>
                    <button id="btnSignup"
                        class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-green-600/20 active:scale-[0.98] transition-all">Cadastrar</button>
                    <p class="text-center text-sm text-gray-400 mt-2">
                        Já tem conta? <button id="btnShowLogin" class="text-blue-400 hover:text-white font-medium">Fazer
                            Login</button>
                    </p>
                </div>

                <button onclick="document.getElementById('authModal').classList.remove('show')"
                    class="absolute top-4 right-4 p-2 text-gray-500 hover:text-white"><i data-lucide="x"
                        class="w-5 h-5"></i></button>
            </div>
        </div>

        <!-- User Dropdown -->
        <div id="userDropdown"
            class="fixed top-20 right-4 w-64 bg-[#2c2c2e] border border-white/10 rounded-xl shadow-2xl p-4 hidden flex-col gap-2 z-50 origin-top-right">
            <div class="flex items-center gap-3 pb-3 border-b border-white/5 mb-1">
                <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center font-bold text-white">U
                </div>
                <div class="overflow-hidden">
                    <p id="userEmail" class="text-sm font-medium text-white truncate">Usuario</p>
                    <p class="text-xs text-green-400">Conta Ativa</p>
                </div>
            </div>
            <button id="btnLogout"
                class="w-full text-left p-2 rounded-lg hover:bg-red-500/10 text-red-400 hover:text-red-300 text-sm font-medium flex items-center gap-2 transition-colors">
                <i data-lucide="log-out" class="w-4 h-4"></i> Sair
            </button>
        </div>

        <!-- Edit Toolbar -->
        <div id="editToolbar"
            class="fixed bg-[#2c2c2e] border border-white/10 p-1.5 rounded-xl shadow-2xl flex items-center gap-1 z-[60] opacity-0 pointer-events-none scale-95 transition-all">
            <button
                class="toolbar-btn w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/10 text-gray-300 hover:text-white"
                data-action="bold"><i data-lucide="bold" class="w-4 h-4"></i></button>
            <button
                class="toolbar-btn w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/10 text-gray-300 hover:text-white"
                data-action="italic"><i data-lucide="italic" class="w-4 h-4"></i></button>
            <div class="w-px h-4 bg-white/10 mx-1"></div>
            <button
                class="toolbar-btn w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/10 text-yellow-400"
                data-action="color"><i data-lucide="palette" class="w-4 h-4"></i></button>
            <button
                class="toolbar-btn w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/10 text-purple-400"
                data-action="habit"><i data-lucide="repeat" class="w-4 h-4"></i></button>
            <button
                class="toolbar-btn w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/10 text-red-400"
                data-action="delete"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
        </div>

        <!-- Color Menu -->
        <div id="colorMenu"
            class="fixed bg-[#2c2c2e] border border-white/10 p-2 rounded-xl shadow-xl grid grid-cols-5 gap-2 z-[70] hidden">
            <button class="color-swatch w-6 h-6 rounded-full bg-gray-400 hover:scale-110 transition-transform"
                data-color="default"></button>
            <button class="color-swatch w-6 h-6 rounded-full bg-blue-500 hover:scale-110 transition-transform"
                data-color="blue"></button>
            <button class="color-swatch w-6 h-6 rounded-full bg-green-500 hover:scale-110 transition-transform"
                data-color="green"></button>
            <button class="color-swatch w-6 h-6 rounded-full bg-yellow-500 hover:scale-110 transition-transform"
                data-color="yellow"></button>
            <button class="color-swatch w-6 h-6 rounded-full bg-red-500 hover:scale-110 transition-transform"
                data-color="red"></button>
        </div>

    </div>

    <script src="js/app.js?v=3"></script>
    <script>
        // Inline Fix for some IDs if needed
        // Force update user email display if app runs
    </script>
</body>

</html>